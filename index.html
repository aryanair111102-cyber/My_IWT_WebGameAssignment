<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Typing Speed Test</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background: #f4f4f4;
        padding: 40px;
        text-align: center;
    }
    #test-box {
        width: 60%;
        margin: auto;
        padding: 20px;
        background: white;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    #sentence {
        font-size: 22px;
        margin-bottom: 20px;
    }
    #input {
        width: 80%;
        font-size: 18px;
        padding: 10px;
        border: 1px solid #aaa;
        border-radius: 5px;
    }
    #timer, #result {
        margin-top: 20px;
        font-size: 20px;
        font-weight: bold;
    }
    button {
        margin: 10px;
        padding: 10px 25px;
        font-size: 16px;
        cursor: pointer;
        background: #4CAF50;
        color: white;
        border: none;
        border-radius: 6px;
    }
    #stopBtn { background: #E53935; }
    #pauseBtn { background: #FF9800; }
</style>
</head>
<body>

<h1>Typing Speed Test</h1>

<div id="test-box">
    <div id="sentence"></div>

    <input id="input" type="text" disabled>

    <div id="timer">Time: 0.0s</div>
    <div id="result"></div>

    <button id="startBtn">Start</button>
    <button id="pauseBtn" disabled>Pause</button>
    <button id="stopBtn" disabled>Stop</button>
</div>

<script>
// Sentences
const sentences = [
    "Hi, My name is Arya Nair.",
    "My Roll no. is 0818CS243D02",
    "The quick brown fox jumps over the lazy dog.",
    "Typing helps improve focus and memory.",
    "This is Internet and Web Technology Assignment.",
    "Type as fast as you can.",
    "Practice every day to improve typing speed."
];

// DOM elements
const sentenceEl = document.getElementById("sentence");
const inputEl = document.getElementById("input");
const timerEl = document.getElementById("timer");
const resultEl = document.getElementById("result");
const startBtn = document.getElementById("startBtn");
const pauseBtn = document.getElementById("pauseBtn");
const stopBtn = document.getElementById("stopBtn");

// State variables
let order = [];
let index = 0;

let startTime = 0;
let pausedTime = 0;
let totalPaused = 0;

let rafId;
let isPaused = false;

let totalTime = 0;
let totalWords = 0;
let totalTyped = 0;
let totalCorrect = 0;

// Start button
startBtn.onclick = () => {
    resetGame();
    startSentence();
};

// Pause/Resume
pauseBtn.onclick = () => {
    if (!isPaused) {
        pauseGame();
    } else {
        resumeGame();
    }
};

// Stop button
stopBtn.onclick = () => {
    stopGame(true); // true = user pressed stop
};

// Reset everything
function resetGame() {
    order = sentences.map((s, i) => i).sort(() => Math.random() - 0.5);
    index = 0;

    totalTime = 0;
    totalWords = 0;
    totalTyped = 0;
    totalCorrect = 0;
    totalPaused = 0;

    inputEl.disabled = false;
    resultEl.innerHTML = "";

    pauseBtn.disabled = false;
    stopBtn.disabled = false;
    isPaused = false;
    pauseBtn.textContent = "Pause";
}

// Start a single sentence
function startSentence() {
    const sentence = sentences[order[index]];
    sentenceEl.textContent = sentence;
    inputEl.value = "";
    inputEl.focus();

    startTime = performance.now();
    updateTimer();
}

// Pause game
function pauseGame() {
    isPaused = true;
    pauseBtn.textContent = "Resume";
    pausedTime = performance.now();
    cancelAnimationFrame(rafId);
    inputEl.disabled = true;
}

// Resume game
function resumeGame() {
    isPaused = false;
    pauseBtn.textContent = "Pause";

    // Add paused duration
    totalPaused += performance.now() - pausedTime;

    startTime = performance.now() - (elapsedTime() * 1000);
    inputEl.disabled = false;
    inputEl.focus();
    updateTimer();
}

// Timer using RAF
function elapsedTime() {
    return (performance.now() - startTime - totalPaused) / 1000;
}

function updateTimer() {
    if (!isPaused) {
        timerEl.textContent = `Time: ${elapsedTime().toFixed(1)}s`;
        rafId = requestAnimationFrame(updateTimer);
    }
}

// Input checking
inputEl.addEventListener("input", () => {
    if (isPaused) return;

    const currentSentence = sentences[order[index]];
    const typed = inputEl.value;

    // Accuracy tracking
    totalTyped++;
    if (typed[typed.length - 1] === currentSentence[typed.length - 1]) {
        totalCorrect++;
    }

    // Sentence not complete yet
    if (typed !== currentSentence) return;

    cancelAnimationFrame(rafId);

    const timeTaken = elapsedTime();
    const words = currentSentence.split(" ").length;

    totalTime += timeTaken;
    totalWords += words;
    totalPaused = 0; // reset pause tracking for next sentence

    index++;

    if (index >= sentences.length) {
        stopGame(false); // finished naturally
        return;
    }

    startSentence();
});

// Stop game early or naturally
function stopGame(stoppedByUser) {
    cancelAnimationFrame(rafId);

    inputEl.disabled = true;
    pauseBtn.disabled = true;
    stopBtn.disabled = true;

    let wpm = Math.round((totalWords / totalTime) * 60);
    let accuracy = ((totalCorrect / totalTyped) * 100).toFixed(2);

    if (stoppedByUser) {
        sentenceEl.textContent = "Game Stopped!";
    } else {
        sentenceEl.textContent = "Test Completed!";
    }

    resultEl.innerHTML =
        `Total time: <b>${totalTime.toFixed(2)}s</b><br>` +
        `Words typed: <b>${totalWords}</b><br>` +
        `Accuracy: <b>${accuracy}%</b><br>` +
        `Average WPM: <b>${wpm}</b>`;
}
</script>

</body>
</html>
